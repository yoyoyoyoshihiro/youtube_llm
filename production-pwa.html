<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTubeâ†’NotebookLM - å®‰å…¨ãªå‹•ç”»è¦ç´„ãƒ„ãƒ¼ãƒ«</title>
    
    <!-- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self'; 
        script-src 'self' 'unsafe-inline' 'strict-dynamic'; 
        style-src 'self' 'unsafe-inline'; 
        img-src 'self' data: https:; 
        connect-src 'self' https://notebooklm.google.com; 
        object-src 'none'; 
        base-uri 'self'; 
        form-action 'self';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="
        camera=(), 
        microphone=(), 
        geolocation=(), 
        payment=(), 
        accelerometer=(), 
        gyroscope=(), 
        magnetometer=()">
    
    <!-- PWAè¨­å®š -->
    <link rel="manifest" href="manifest-secure.json">
    <meta name="theme-color" content="#ff0000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="YouTubeâ†’NotebookLM">
    
    <!-- SEOãƒ»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ -->
    <meta name="description" content="YouTubeå‹•ç”»ã‚’å®‰å…¨ã«NotebookLMã§è¦ç´„ã€‚ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·ã€ã‚»ã‚­ãƒ¥ã‚¢å‡¦ç†ã€30ç§’ã§å°å…¥å®Œäº†ã€‚">
    <meta name="keywords" content="YouTube, NotebookLM, è¦ç´„, ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·, PWA">
    <meta name="author" content="YouTubeâ†’NotebookLM">
    <meta name="robots" content="index, follow">
    
    <style>
        /* ã‚»ã‚­ãƒ¥ã‚¢ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° - ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³å‰Šæ¸› */
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #28a745;
            --error-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: white;
            overflow-x: hidden;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 450px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            color: var(--dark-color);
            position: relative;
        }
        
        .header {
            margin-bottom: 30px;
        }
        
        .logo {
            font-size: 48px;
            margin-bottom: 10px;
            user-select: none;
        }
        
        .title {
            font-size: 26px;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--dark-color);
        }
        
        .subtitle {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 20px;
        }
        
        .security-badge {
            display: inline-flex;
            align-items: center;
            background: var(--success-color);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 20px;
        }
        
        .input-section {
            margin-bottom: 25px;
        }
        
        .url-input {
            width: 100%;
            padding: 16px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            resize: none;
            font-family: inherit;
        }
        
        .url-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .url-input.error {
            border-color: var(--error-color);
            background-color: #fff5f5;
        }
        
        .url-input.success {
            border-color: var(--success-color);
            background-color: #f0fff4;
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .btn {
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: inherit;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
        }
        
        .btn-secondary {
            background: var(--success-color);
            color: white;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .status {
            padding: 12px 16px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
            font-size: 14px;
            font-weight: 500;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status.processing {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .info-section {
            background: var(--light-color);
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
            text-align: left;
            font-size: 14px;
        }
        
        .info-section h3 {
            margin-bottom: 12px;
            color: var(--dark-color);
            font-size: 16px;
        }
        
        .info-section ol {
            margin-left: 20px;
            line-height: 1.6;
        }
        
        .info-section li {
            margin-bottom: 6px;
        }
        
        .security-info {
            background: #e8f5e8;
            border-left: 4px solid var(--success-color);
            padding: 15px;
            margin-top: 20px;
            border-radius: 0 8px 8px 0;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .privacy-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            font-size: 12px;
        }
        
        .privacy-links a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }
        
        .privacy-links a:hover {
            text-decoration: underline;
        }
        
        .install-prompt {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab795 100%);
            border: 1px solid #f39c12;
            color: #8b4513;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 25px;
            display: none;
            font-weight: 500;
        }
        
        .version-info {
            position: absolute;
            bottom: 10px;
            right: 15px;
            font-size: 10px;
            color: #adb5bd;
            user-select: none;
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 480px) {
            .container {
                margin: 10px;
                padding: 20px;
            }
            
            .title {
                font-size: 22px;
            }
            
            .logo {
                font-size: 40px;
            }
        }
        
        /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ */
        @media (prefers-color-scheme: dark) {
            .container {
                background: rgba(33, 37, 41, 0.95);
                color: #f8f9fa;
            }
            
            .title {
                color: #f8f9fa;
            }
            
            .url-input {
                background: #495057;
                border-color: #6c757d;
                color: #f8f9fa;
            }
            
            .info-section {
                background: #495057;
                color: #f8f9fa;
            }
        }
        
        /* é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ */
        @media (prefers-contrast: high) {
            .btn {
                border: 2px solid currentColor;
            }
            
            .url-input {
                border-width: 3px;
            }
        }
        
        /* å‹•ä½œè»½æ¸›ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="version-info">v1.0.0</div>
        
        <header class="header">
            <div class="logo" role="img" aria-label="YouTube to NotebookLM logo">ğŸ”—ğŸ“š</div>
            <h1 class="title">YouTubeâ†’NotebookLM</h1>
            <p class="subtitle">YouTubeå‹•ç”»ã‚’å®‰å…¨ã«NotebookLMã§è¦ç´„</p>
            <div class="security-badge">
                ğŸ”’ ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·ãƒ»ã‚»ã‚­ãƒ¥ã‚¢å‡¦ç†
            </div>
        </header>
        
        <div class="install-prompt" id="installPrompt" role="banner">
            <strong>ğŸ“± å…±æœ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ä½¿ç”¨ã™ã‚‹ã«ã¯ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã—ã¦ãã ã•ã„</strong>
        </div>
        
        <div class="status" id="status" role="alert" aria-live="polite"></div>
        
        <main>
            <section class="input-section">
                <label for="urlInput" class="sr-only">YouTube URLå…¥åŠ›æ¬„</label>
                <textarea 
                    id="urlInput" 
                    class="url-input"
                    placeholder="YouTube URLã‚’å…¥åŠ›ã¾ãŸã¯ãƒšãƒ¼ã‚¹ãƒˆ&#10;ä¾‹: https://youtube.com/watch?v=..."
                    rows="3"
                    autocomplete="off"
                    spellcheck="false"
                    autocorrect="off"
                    autocapitalize="off"
                    aria-describedby="url-help"
                ></textarea>
                <div id="url-help" class="sr-only">
                    YouTube URLã®ã¿å—ã‘ä»˜ã‘ã¾ã™ã€‚æ©Ÿå¯†æƒ…å ±ã‚’å«ã‚€URLã¯è‡ªå‹•çš„ã«æ‹’å¦ã•ã‚Œã¾ã™ã€‚
                </div>
            </section>
            
            <div class="button-group">
                <button 
                    type="button" 
                    class="btn btn-primary" 
                    id="processBtn" 
                    onclick="processUrl()"
                    aria-describedby="process-help"
                >
                    <span>ğŸš€</span>
                    NotebookLMã§é–‹ã
                </button>
                
                <button 
                    type="button" 
                    class="btn btn-secondary" 
                    id="pasteBtn" 
                    onclick="pasteFromClipboard()"
                    aria-describedby="paste-help"
                >
                    <span>ğŸ“‹</span>
                    ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰ãƒšãƒ¼ã‚¹ãƒˆ
                </button>
            </div>
            
            <div id="process-help" class="sr-only">
                å…¥åŠ›ã•ã‚ŒãŸYouTube URLã‚’æ¤œè¨¼ã—ã¦NotebookLMã§é–‹ãã¾ã™
            </div>
            <div id="paste-help" class="sr-only">
                ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰YouTube URLã‚’ãƒšãƒ¼ã‚¹ãƒˆã—ã¾ã™
            </div>
        </main>
        
        <section class="info-section">
            <h3>ğŸš€ ä½¿ã„æ–¹</h3>
            <ol>
                <li>YouTubeã‚¢ãƒ—ãƒªã§å‹•ç”»ã‚’é–‹ã</li>
                <li>å…±æœ‰ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—</li>
                <li>ã€ŒYouTubeâ†’NotebookLMã€ã‚’é¸æŠ</li>
                <li>è‡ªå‹•ã§NotebookLMãŒèµ·å‹•</li>
            </ol>
        </section>
        
        <div class="security-info">
            <strong>ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¿è¨¼:</strong><br>
            â€¢ ã™ã¹ã¦ç«¯æœ«å†…ã§å‡¦ç†ã€å¤–éƒ¨é€ä¿¡ãªã—<br>
            â€¢ URLå±¥æ­´ã®ä¿å­˜ãªã—<br>
            â€¢ æ©Ÿå¯†æƒ…å ±ã®è‡ªå‹•æ¤œå‡ºãƒ»é™¤å¤–<br>
            â€¢ HTTPSå¿…é ˆãƒ»CSPé©ç”¨
        </div>
        
        <nav class="privacy-links">
            <a href="#privacy" onclick="showPrivacyPolicy()" role="button">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>
            <a href="#terms" onclick="showTerms()" role="button">åˆ©ç”¨è¦ç´„</a>
            <a href="#security" onclick="showSecurityInfo()" role="button">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</a>
        </nav>
    </div>

    <script>
        'use strict';
        
        // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
        const SECURITY_CONFIG = {
            MAX_URL_LENGTH: 2000,
            ALLOWED_DOMAINS: [
                'youtube.com',
                'www.youtube.com',
                'm.youtube.com',
                'youtu.be'
            ],
            SENSITIVE_PATTERNS: [
                /password/i, /token/i, /key/i, /auth/i,
                /email/i, /phone/i, /address/i, /login/i,
                /secret/i, /private/i, /confidential/i,
                /api[_-]?key/i, /access[_-]?token/i
            ],
            RATE_LIMIT: {
                maxRequests: 10,
                timeWindow: 60000 // 1åˆ†
            }
        };
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ç®¡ç†
        const APP_STATE = {
            requestCount: 0,
            lastRequestTime: 0,
            isProcessing: false,
            securityViolations: 0
        };
        
        // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°
        function logSecurityEvent(event, details = {}) {
            const timestamp = new Date().toISOString();
            const logEntry = {
                timestamp,
                event,
                details,
                userAgent: navigator.userAgent.substring(0, 100),
                url: window.location.hostname
            };
            
            // æœ¬ç•ªç’°å¢ƒã§ã¯é©åˆ‡ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã«é€ä¿¡
            console.info('Security Event:', logEntry);
            
            // é‡å¤§ãªé•åã®å ´åˆ
            if (event === 'SECURITY_VIOLATION') {
                APP_STATE.securityViolations++;
                if (APP_STATE.securityViolations > 5) {
                    showStatus('ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ç†ç”±ã«ã‚ˆã‚Šä¸€æ™‚çš„ã«åˆ©ç”¨ã‚’åˆ¶é™ã—ã¦ã„ã¾ã™', 'error');
                    return false;
                }
            }
            
            return true;
        }
        
        // ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯
        function checkRateLimit() {
            const now = Date.now();
            const timeDiff = now - APP_STATE.lastRequestTime;
            
            if (timeDiff > SECURITY_CONFIG.RATE_LIMIT.timeWindow) {
                APP_STATE.requestCount = 0;
            }
            
            if (APP_STATE.requestCount >= SECURITY_CONFIG.RATE_LIMIT.maxRequests) {
                logSecurityEvent('RATE_LIMIT_EXCEEDED', {
                    requestCount: APP_STATE.requestCount,
                    timeWindow: SECURITY_CONFIG.RATE_LIMIT.timeWindow
                });
                return false;
            }
            
            APP_STATE.requestCount++;
            APP_STATE.lastRequestTime = now;
            return true;
        }
        
        // å³å¯†ãªYouTube URLæ¤œè¨¼
        function validateYouTubeURL(url) {
            try {
                // é•·ã•ãƒã‚§ãƒƒã‚¯
                if (!url || url.length > SECURITY_CONFIG.MAX_URL_LENGTH) {
                    logSecurityEvent('INVALID_URL_LENGTH', { length: url?.length });
                    return { valid: false, reason: 'URLã®é•·ã•ãŒä¸æ­£ã§ã™' };
                }
                
                // URLå½¢å¼ãƒã‚§ãƒƒã‚¯
                const urlObj = new URL(url);
                
                // ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒã‚§ãƒƒã‚¯
                if (!['https:', 'http:'].includes(urlObj.protocol)) {
                    logSecurityEvent('INVALID_PROTOCOL', { protocol: urlObj.protocol });
                    return { valid: false, reason: 'ä¸æ­£ãªãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã™' };
                }
                
                // ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯
                const hostname = urlObj.hostname.toLowerCase();
                const isValidDomain = SECURITY_CONFIG.ALLOWED_DOMAINS.some(domain => 
                    hostname === domain || hostname.endsWith('.' + domain)
                );
                
                if (!isValidDomain) {
                    logSecurityEvent('INVALID_DOMAIN', { hostname });
                    return { valid: false, reason: 'YouTubeä»¥å¤–ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã™' };
                }
                
                // YouTubeãƒ‘ã‚¹æ¤œè¨¼
                const path = urlObj.pathname;
                const searchParams = urlObj.searchParams;
                
                const validPatterns = [
                    { test: () => path === '/watch' && searchParams.has('v'), type: 'watch' },
                    { test: () => path.startsWith('/shorts/'), type: 'shorts' },
                    { test: () => hostname === 'youtu.be' && path.length > 1, type: 'short_url' }
                ];
                
                const matchedPattern = validPatterns.find(pattern => pattern.test());
                if (!matchedPattern) {
                    logSecurityEvent('INVALID_YOUTUBE_PATH', { path, hostname });
                    return { valid: false, reason: 'æœ‰åŠ¹ãªYouTube URLã§ã¯ã‚ã‚Šã¾ã›ã‚“' };
                }
                
                // æ©Ÿå¯†æƒ…å ±ãƒã‚§ãƒƒã‚¯
                const fullUrl = url.toLowerCase();
                for (const pattern of SECURITY_CONFIG.SENSITIVE_PATTERNS) {
                    if (pattern.test(fullUrl)) {
                        logSecurityEvent('SENSITIVE_DATA_DETECTED', { pattern: pattern.source });
                        return { valid: false, reason: 'æ©Ÿå¯†æƒ…å ±ã‚’å«ã‚€å¯èƒ½æ€§ãŒã‚ã‚‹URLã§ã™' };
                    }
                }
                
                logSecurityEvent('URL_VALIDATED', { type: matchedPattern.type, hostname });
                return { valid: true, normalizedUrl: normalizeYouTubeURL(url) };
                
            } catch (error) {
                logSecurityEvent('URL_VALIDATION_ERROR', { error: error.message });
                return { valid: false, reason: 'URLå½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“' };
            }
        }
        
        // URLæ­£è¦åŒ–ï¼ˆã‚»ã‚­ãƒ¥ã‚¢ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
        function normalizeYouTubeURL(url) {
            try {
                const urlObj = new URL(url);
                
                // youtu.be â†’ youtube.com å¤‰æ›
                if (urlObj.hostname === 'youtu.be') {
                    const videoId = urlObj.pathname.slice(1).split('?')[0];
                    return `https://www.youtube.com/watch?v=${encodeURIComponent(videoId)}`;
                }
                
                // ãƒ¢ãƒã‚¤ãƒ«ç‰ˆ â†’ ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç‰ˆ
                if (urlObj.hostname === 'm.youtube.com') {
                    urlObj.hostname = 'www.youtube.com';
                    return urlObj.toString();
                }
                
                // ä¸è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿é™¤å»ï¼ˆãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·ï¼‰
                const cleanParams = new URLSearchParams();
                if (urlObj.searchParams.has('v')) {
                    cleanParams.set('v', urlObj.searchParams.get('v'));
                }
                if (urlObj.searchParams.has('t')) {
                    cleanParams.set('t', urlObj.searchParams.get('t'));
                }
                
                urlObj.search = cleanParams.toString();
                return urlObj.toString();
                
            } catch (error) {
                logSecurityEvent('URL_NORMALIZATION_ERROR', { error: error.message });
                return url; // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            }
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºï¼ˆã‚»ã‚­ãƒ¥ã‚¢ç‰ˆï¼‰
        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            const allowedTypes = ['success', 'error', 'warning', 'processing', 'info'];
            
            if (!allowedTypes.includes(type)) {
                type = 'info';
            }
            
            // XSSé˜²æ­¢ã®ãŸã‚textContentã‚’ä½¿ç”¨
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            
            // è‡ªå‹•éè¡¨ç¤ºï¼ˆå‡¦ç†ä¸­ä»¥å¤–ï¼‰
            if (type !== 'processing') {
                setTimeout(() => {
                    status.style.display = 'none';
                }, 5000);
            }
            
            // ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£é€šçŸ¥
            status.setAttribute('aria-live', type === 'error' ? 'assertive' : 'polite');
        }
        
        // NotebookLMèµ·å‹•ï¼ˆã‚»ã‚­ãƒ¥ã‚¢ç‰ˆï¼‰
        async function openNotebookLM(url) {
            try {
                showStatus('NotebookLMã‚’èµ·å‹•ä¸­...', 'processing');
                
                // Intent URIã®å®‰å…¨ãªæ§‹ç¯‰
                const encodedUrl = encodeURIComponent(url);
                const appIntent = `intent://notebook/#Intent;scheme=https;package=com.google.android.apps.notebook;S.android.intent.extra.TEXT=${encodedUrl};end`;
                
                // Webç‰ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯URL
                const webUrl = 'https://notebooklm.google.com/';
                
                // ã‚¢ãƒ—ãƒªèµ·å‹•è©¦è¡Œ
                const startTime = Date.now();
                window.location.href = appIntent;
                
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
                const fallbackTimer = setTimeout(() => {
                    const elapsed = Date.now() - startTime;
                    if (elapsed > 1000) { // 1ç§’çµŒéã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                        showStatus('ã‚¢ãƒ—ãƒªãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯Webç‰ˆã‚’é–‹ãã¾ã™', 'warning');
                        setTimeout(() => {
                            window.open(webUrl, '_blank', 'noopener,noreferrer');
                            showStatus('NotebookLM Webç‰ˆã‚’é–‹ãã¾ã—ãŸ', 'success');
                        }, 1500);
                    }
                }, 1000);
                
                // ãƒšãƒ¼ã‚¸ãŒéè¡¨ç¤ºã«ãªã£ãŸå ´åˆï¼ˆã‚¢ãƒ—ãƒªèµ·å‹•æˆåŠŸï¼‰
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) {
                        clearTimeout(fallbackTimer);
                        showStatus('NotebookLMã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã¾ã—ãŸ', 'success');
                    }
                }, { once: true });
                
                logSecurityEvent('NOTEBOOKLM_LAUNCH_ATTEMPT', { method: 'app_intent' });
                
            } catch (error) {
                logSecurityEvent('NOTEBOOKLM_LAUNCH_ERROR', { error: error.message });
                // ã‚¨ãƒ©ãƒ¼æ™‚ã¯Webç‰ˆã®ã¿
                window.open('https://notebooklm.google.com/', '_blank', 'noopener,noreferrer');
                showStatus('NotebookLM Webç‰ˆã‚’é–‹ãã¾ã—ãŸ', 'success');
            }
        }
        
        // ãƒ¡ã‚¤ãƒ³å‡¦ç†é–¢æ•°ï¼ˆã‚»ã‚­ãƒ¥ã‚¢ç‰ˆï¼‰
        async function processUrl() {
            // é‡è¤‡å‡¦ç†é˜²æ­¢
            if (APP_STATE.isProcessing) {
                return;
            }
            
            // ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯
            if (!checkRateLimit()) {
                showStatus('ã‚¢ã‚¯ã‚»ã‚¹é »åº¦ãŒé«˜ã™ãã¾ã™ã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            APP_STATE.isProcessing = true;
            
            try {
                const input = document.getElementById('urlInput');
                const url = input.value.trim();
                
                // å…¥åŠ›ãƒã‚§ãƒƒã‚¯
                if (!url) {
                    showStatus('URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                    return;
                }
                
                // URLæ¤œè¨¼
                const validation = validateYouTubeURL(url);
                if (!validation.valid) {
                    showStatus(validation.reason, 'error');
                    input.classList.add('error');
                    setTimeout(() => input.classList.remove('error'), 3000);
                    return;
                }
                
                // æˆåŠŸè¡¨ç¤º
                input.classList.add('success');
                setTimeout(() => input.classList.remove('success'), 2000);
                
                // NotebookLMèµ·å‹•
                await openNotebookLM(validation.normalizedUrl);
                
                // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                setTimeout(() => {
                    input.value = '';
                    input.classList.remove('success', 'error');
                }, 3000);
                
            } catch (error) {
                logSecurityEvent('PROCESS_URL_ERROR', { error: error.message });
                showStatus('å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
            } finally {
                APP_STATE.isProcessing = false;
            }
        }
        
        // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¹ãƒˆï¼ˆã‚»ã‚­ãƒ¥ã‚¢ç‰ˆï¼‰
        async function pasteFromClipboard() {
            try {
                // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰æ¨©é™ãƒã‚§ãƒƒã‚¯
                const permission = await navigator.permissions.query({ name: 'clipboard-read' });
                if (permission.state === 'denied') {
                    showStatus('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒå¿…è¦ã§ã™', 'error');
                    return;
                }
                
                const text = await navigator.clipboard.readText();
                
                // é•·ã•åˆ¶é™
                if (text.length > SECURITY_CONFIG.MAX_URL_LENGTH) {
                    showStatus('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã®å†…å®¹ãŒé•·ã™ãã¾ã™', 'error');
                    return;
                }
                
                document.getElementById('urlInput').value = text;
                showStatus('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰ãƒšãƒ¼ã‚¹ãƒˆã—ã¾ã—ãŸ', 'success');
                
                logSecurityEvent('CLIPBOARD_PASTE_SUCCESS');
                
            } catch (error) {
                logSecurityEvent('CLIPBOARD_PASTE_ERROR', { error: error.message });
                showStatus('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“', 'error');
            }
        }
        
        // ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼è¡¨ç¤º
        function showPrivacyPolicy() {
            const content = `
ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã€‘

1. åé›†ã™ã‚‹æƒ…å ±
   - YouTube URLã®ã¿ä¸€æ™‚çš„ã«å‡¦ç†
   - å€‹äººæƒ…å ±ã¯ä¸€åˆ‡åé›†ã—ã¾ã›ã‚“

2. æƒ…å ±ã®åˆ©ç”¨
   - NotebookLMã¸ã®è»¢é€ã®ã¿
   - è§£æãƒ»åºƒå‘Šãƒ»ç¬¬ä¸‰è€…æä¾›ãªã—

3. ä¿å­˜æœŸé–“
   - URLã¯å‡¦ç†å¾Œå³åº§ã«å‰Šé™¤
   - å±¥æ­´ãƒ»ãƒ­ã‚°ã¯ä¿å­˜ã—ã¾ã›ã‚“

4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
   - HTTPSé€šä¿¡
   - CSPé©ç”¨
   - æ©Ÿå¯†æƒ…å ±è‡ªå‹•æ¤œå‡º

5. ãŠå•ã„åˆã‚ã›
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã™ã‚‹è³ªå•ã¯
     GitHubã®Issueã¾ã§
            `;
            alert(content);
        }
        
        // åˆ©ç”¨è¦ç´„è¡¨ç¤º
        function showTerms() {
            const content = `
ã€åˆ©ç”¨è¦ç´„ã€‘

1. åˆ©ç”¨ç›®çš„
   - YouTubeå‹•ç”»ã®è¦ç´„ç›®çš„ã®ã¿
   - å•†ç”¨åˆ©ç”¨ã¯ç¦æ­¢

2. ç¦æ­¢äº‹é …
   - æ©Ÿå¯†æƒ…å ±ã‚’å«ã‚€URLã®å…¥åŠ›
   - å¤§é‡ã‚¢ã‚¯ã‚»ã‚¹ãƒ»è‡ªå‹•åŒ–
   - ä¸æ­£ãªç›®çš„ã§ã®åˆ©ç”¨

3. å…è²¬äº‹é …
   - ã‚µãƒ¼ãƒ“ã‚¹ã®å¯ç”¨æ€§ã¯ä¿è¨¼ã—ã¾ã›ã‚“
   - ãƒ‡ãƒ¼ã‚¿æå¤±ã®è²¬ä»»ã¯è² ã„ã¾ã›ã‚“

4. æº–æ‹ æ³•
   - æ—¥æœ¬æ³•ã«æº–æ‹ 
   - å€‹äººæƒ…å ±ä¿è­·æ³•éµå®ˆ

5. å¤‰æ›´
   - æœ¬è¦ç´„ã¯äºˆå‘Šãªãå¤‰æ›´ã•ã‚Œã‚‹
     å ´åˆãŒã‚ã‚Šã¾ã™
            `;
            alert(content);
        }
        
        // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æƒ…å ±è¡¨ç¤º
        function showSecurityInfo() {
            const content = `
ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã€‘

1. é€šä¿¡ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
   âœ… HTTPSå¿…é ˆ
   âœ… CSPé©ç”¨
   âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼

2. ãƒ‡ãƒ¼ã‚¿ä¿è­·
   âœ… ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†ã®ã¿
   âœ… å±¥æ­´ä¿å­˜ãªã—
   âœ… è‡ªå‹•ãƒ‡ãƒ¼ã‚¿å‰Šé™¤

3. å…¥åŠ›æ¤œè¨¼
   âœ… YouTube URLé™å®š
   âœ… æ©Ÿå¯†æƒ…å ±æ¤œå‡º
   âœ… ãƒ¬ãƒ¼ãƒˆåˆ¶é™

4. ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼
   âœ… å€‹äººæƒ…å ±åé›†ãªã—
   âœ… è¿½è·¡ãªã—
   âœ… Cookieä½¿ç”¨ãªã—

5. ç›£æŸ»
   âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°
   âœ… ç•°å¸¸æ¤œçŸ¥
   âœ… è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯
            `;
            alert(content);
        }
        
        // åˆæœŸåŒ–å‡¦ç†
        document.addEventListener('DOMContentLoaded', () => {
            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰å…±æœ‰ã•ã‚ŒãŸURLã‚’å–å¾—
            const urlParams = new URLSearchParams(window.location.search);
            const sharedUrl = urlParams.get('url') || urlParams.get('text');
            
            if (sharedUrl) {
                document.getElementById('urlInput').value = sharedUrl;
                // å…±æœ‰ã‹ã‚‰æ¥ãŸå ´åˆã¯è‡ªå‹•å‡¦ç†
                setTimeout(processUrl, 500);
            }
            
            // PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¿ƒé€²
            if (!window.matchMedia('(display-mode: standalone)').matches) {
                document.getElementById('installPrompt').style.display = 'block';
            }
            
            // Enterã‚­ãƒ¼å¯¾å¿œ
            document.getElementById('urlInput').addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                    e.preventDefault();
                    processUrl();
                }
            });
            
            // Service Workerç™»éŒ²
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw-secure.js')
                    .then(registration => {
                        logSecurityEvent('SERVICE_WORKER_REGISTERED');
                    })
                    .catch(error => {
                        logSecurityEvent('SERVICE_WORKER_REGISTRATION_FAILED', { error: error.message });
                    });
            }
            
            logSecurityEvent('APP_INITIALIZED');
        });
        
        // ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        window.addEventListener('beforeunload', () => {
            // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
            const input = document.getElementById('urlInput');
            if (input) {
                input.value = '';
            }
            
            // çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ
            Object.assign(APP_STATE, {
                isProcessing: false,
                requestCount: 0
            });
        });
        
        // CSPé•åãƒ¬ãƒãƒ¼ãƒˆå‡¦ç†
        document.addEventListener('securitypolicyviolation', (e) => {
            logSecurityEvent('CSP_VIOLATION', {
                violatedDirective: e.violatedDirective,
                blockedURI: e.blockedURI,
                documentURI: e.documentURI
            });
        });
        
        logSecurityEvent('SECURITY_SCRIPT_LOADED');
    </script>
</body>
</html>